<!doctype html>
<html lang="en">
<%- include('partials/head') %>
<body>
  <%- include('partials/topbar') %>

  <main class="container">
    <section class="stats-grid">
      <article class="card stat-card">
        <p class="stat-label">Monitoring</p>
        <p class="stat-value"><%= stats.total %> applications</p>
      </article>
      <article class="card stat-card">
        <p class="stat-label">Online</p>
        <p class="stat-value"><%= stats.up %></p>
      </article>
      <article class="card stat-card">
        <p class="stat-label">Down</p>
        <p class="stat-value"><%= stats.down %></p>
      </article>
    </section>

    <section class="card">
      <h1>Stats (Last 24 Hours)</h1>
      <div id="stats-chart" class="chart"></div>
    </section>
  </main>

  <script src="/vendor/echarts/echarts.min.js"></script>
  <script nonce="<%= nonce %>">
    const trend = <%- JSON.stringify(trend) %>;
    const chartEl = document.getElementById('stats-chart');

    if (!trend.length || typeof echarts === 'undefined') {
      chartEl.innerHTML = '<p class="empty-chart">No stats data yet. Wait for checks to run.</p>';
    } else {
      const labels = trend.map((point) => new Date(point.time.replace(' ', 'T')).toLocaleTimeString());
      const upSeries = trend.map((point) => point.up);
      const downSeries = trend.map((point) => point.down);
      const totalSeries = trend.map((point) => point.total);
      const chart = echarts.init(chartEl);

      chart.setOption({
        backgroundColor: 'transparent',
        grid: { left: 40, right: 20, top: 30, bottom: 30 },
        tooltip: { trigger: 'axis' },
        legend: {
          data: ['Up Checks', 'Down Checks', 'Total Checks'],
          textStyle: { color: '#8b949e' },
          top: 0,
        },
        xAxis: {
          type: 'category',
          data: labels,
          axisLabel: { color: '#8b949e', hideOverlap: true },
          axisLine: { lineStyle: { color: '#30363d' } },
        },
        yAxis: {
          type: 'value',
          min: 0,
          axisLabel: { color: '#8b949e' },
          splitLine: { lineStyle: { color: '#30363d' } },
        },
        series: [
          { name: 'Up Checks', type: 'line', smooth: true, symbol: 'none', data: upSeries, lineStyle: { width: 2, color: '#00ff88' } },
          { name: 'Down Checks', type: 'line', smooth: true, symbol: 'none', data: downSeries, lineStyle: { width: 2, color: '#ff4d4f' } },
          { name: 'Total Checks', type: 'line', smooth: true, symbol: 'none', data: totalSeries, lineStyle: { width: 2, color: '#1f6feb' } },
        ],
      });

      window.addEventListener('resize', () => chart.resize());
    }
  </script>
  <%- include('partials/footer') %>
</body>
</html>

